Прочитать о том, как решать класс задач про отрезки можно [тут](../tasks/task-about-segments.html)

Сначала декомпозируем задачу на две отдельных более простых. Надо посчитать количество отрезов по длине не больше $m_2$, а затем из этого количества вычесть количество отрезков с длиной не больше $m_1 - 1$. Рассмотрим как решать задачу по нахождению отрезков $[a, b]$, что объединение по длине $\le k$.

Как понять подходит ли отрезок $[a, b]$? Достаточно взять самую правую среди левых границ и самую левую среди правых, другими словами максимум из левых и минимум из правых. Тогда если максимум не больше минимума отрезок существует. Перепишу более понятнее $$max(l) - min(r)$$

Из этого следует монотонность при добавление новых отрезков, так как при этом $max(l)$ не уменьшается, а $min(r)$ не увеличивается, следовательно $max(l) - min(r)$ не увеличивается. Под добавлением тут подразумевается добавление любого отрезка, но нам лишь нужна **монотонность по правой** границе.

Монотонность по левой не выполняется. При удаление $l$-го отрезка, $max(l)$ не увеличится, а $min(r)$ не уменьшится. Из этого следует непонятных характер функции $max(l) - min(r)$ &mdash; она как и возрастёт, так и может упасть. Обратное противоречие добавлению, что действительно очевидно.

Значит, если найти максимальный индекс правой границы для фиксированного $a$, обозначим его за $k$. То в ответ можно добавить разницу индексов плюс один, так как для фиксированного $a$ подходят любые $b$ от $a$ до $k$.

Значит достаточно перебрать все левые границы, а правую границу получать каждый раз **бинпоиском**. Что-бы понять подходит ли отрезок $[a, b]$, достаточно взять максимум по правым в массиве правых границ на отрезке $[a, b]$ и аналогично минимум по массиву из левых границ. Для того чтобы брать минимум за $O(1)$ надо воспользоваться разряженной таблицей.

Вы можете не знать, как магически взять минимум значений на отрезке, главное в этой задаче понять, что границы подаются бинпоиску,  даже такому неочевидному и понять монотонность границ.

Ассимптотика $O(n \log n)$.

Более общий разбор вы можете найти [тут](https://neerc.ifmo.ru/school/io/archive/20220129/tutorial-20220129-individual.pdf).